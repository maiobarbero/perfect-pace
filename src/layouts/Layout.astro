---
import "../assets/styles/app.css";
import Footer from "../components/Footer.astro"
import Navbar from "../components/Navbar.astro"
import SEO from "../components/SEO.astro"
import CookieBanner from "../components/CookieBanner.jsx"

interface Props {
    title?: string;
    description?: string;
    image?: string;
}

const { title, description, image } = Astro.props;
---

<!doctype html>
<html lang="en">
	<head>
        <SEO title={title} description={description} image={image} />

        <link href="https://fonts.googleapis.com" rel="preconnect"/>
        <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&amp;family=Roboto+Mono:wght@400;500;700&amp;display=swap" rel="stylesheet"/>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet"/>
        <link rel="manifest" href="/perfect-pace/manifest.json" />

        <!-- Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-LMTDVWZGR4"></script>
        <script is:inline>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-LMTDVWZGR4');

            // Track PWA Installation
            window.addEventListener('appinstalled', () => {
                gtag('event', 'pwa_install', {
                    'event_category': 'pwa',
                    'event_label': 'install',
                    'value': 1
                });
            });
        </script>

        <script is:inline>
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('/perfect-pace/sw.js')
                        .then(registration => {
                            console.log('SW registered: ', registration);
                        })
                        .catch(registrationError => {
                            console.log('SW registration failed: ', registrationError);
                        });
                });
            }

            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
              document.documentElement.classList.add('dark')
            } else {
              document.documentElement.classList.remove('dark')
            }
        </script>
	</head>
    <body class="bg-background-light dark:bg-background-dark text-slate-800 dark:text-slate-100 font-display transition-colors duration-300 min-h-screen flex flex-col">
        <Navbar />
        <main class="flex-grow container mx-auto px-4 pb-12 max-w-5xl space-y-8">
		    <slot />
        </main>
        <Footer />

        <div class="fixed bottom-4 right-4 no-print">
            <button class="bg-surface-dark dark:bg-surface-light text-white dark:text-slate-900 p-3 rounded-full shadow-lg transition-transform hover:scale-110" id="theme-toggle" aria-label="Toggle Dark Mode">
            <span class="material-icons-round dark:hidden">dark_mode</span>
            <span class="material-icons-round hidden dark:block">light_mode</span>
            </button>
        </div>
        <script is:inline>
            document.getElementById('theme-toggle').addEventListener('click', () => {
                if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
                } else {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
                }
            });
        </script>
        <CookieBanner client:load />
	</body>
</html>
